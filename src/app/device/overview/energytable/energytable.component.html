<div *ngIf="device" fxLayout fxLayoutAlign="start start" fxLayoutWrap="wrap">

  <md-card fxFlex="100%" class="single_leftright single_top">
    <md-card-header>
      <md-icon md-card-avatar>format_list_bulleted</md-icon>
      <md-card-title i18n>Energietabelle</md-card-title>
    </md-card-header>
    <md-card-content *ngIf="device.websocket.isConnected == false">
      <span>{{ device.websocket.connectionLostOutput }}</span>
    </md-card-content>
  </md-card>
  <ng-container *ngFor="let thing of device.data | async | keys">

    <!-- Storage -->
    <ng-container *ngIf="device.things.storage[thing.key]">
      <md-card *ngIf="device.websocket.isConnected == true" class="single_leftright" fxFlex="100%">
        <md-card-header>
          <img src="assets/img/storage.png" md-card-avatar/>
          <md-card-title i18n>Speichersystem</md-card-title>
          <md-card-subtitle>{{ thing.key }}</md-card-subtitle>
        </md-card-header>
        <md-card-content>
          <table class="full_width">
            <tr>
              <td style="width:50%" i18n>Ladezustand</td>
              <td style="width:15%"></td>
              <td style="width:25%" class="align_right">{{ thing.value.Soc }}</td>
              <td style="width:10%">%</td>
            </tr>
            <ng-container *ngIf="thing.value.ActivePower != null && thing.value.ReactivePower != null">
              <tr>
                <td i18n>Beladeleistung</td>
                <td></td>
                <td class="align_right" *ngIf="thing.value.ActivePower < 0">{{ thing.value.ActivePower | sign }}</td>
                <td class="align_right" *ngIf="thing.value.ActivePower >= 0">0</td>
                <td>W</td>
              </tr>
              <tr>
                <td i18n>Entladeleistung</td>
                <td></td>
                <td class="align_right" *ngIf="thing.value.ActivePower > 0">{{ thing.value.ActivePower }}</td>
                <td class="align_right" *ngIf="thing.value.ActivePower <= 0">0</td>
                <td>W</td>
              </tr>
              <tr class="gray_color">
                <td i18n>Blindleistung</td>
                <td></td>
                <td class="align_right">{{ thing.value.ReactivePower }}</td>
                <td>var</td>
              </tr>
            </ng-container>
            <ng-container *ngIf="thing.value.ActivePowerL1 != null&& thing.value.ActivePowerL2 != null && thing.value.ActivePowerL3 != null">
              <tr>
                <td style="width:50%" i18n>Ausgabeleistung</td>
                <td style="width:15%">L1</td>
                <td style="width:25%" class="align_right">{{ thing.value.ActivePowerL1 }}</td>
                <td style="width:10%">W</td>
              </tr>
              <tr>
                <td></td>
                <td>L2</td>
                <td class="align_right">{{ thing.value.ActivePowerL2 }}</td>
                <td>W</td>
              </tr>
              <tr>
                <td></td>
                <td>L3</td>
                <td class="align_right">{{ thing.value.ActivePowerL3 }}</td>
                <td>W</td>
              </tr>
            </ng-container>
          </table>
        </md-card-content>
      </md-card>
    </ng-container>

    <!-- Grid -->
    <ng-container *ngIf="device.things.grid[thing.key]">
      <md-card *ngIf="device.websocket.isConnected == true" class="single_leftright" fxFlex="100%">
        <md-card-header>
          <img src="assets/img/grid.png" md-card-avatar/>
          <md-card-title>Netzzähler</md-card-title>
          <md-card-subtitle>{{ thing.key }}</md-card-subtitle>
        </md-card-header>
        <md-card-content>
          <table class="full_width">
            <ng-container *ngIf="thing.value.ActivePower != null && thing.value.ReactivePower != null">
              <tr>
                <td style="width:50%" i18n>Bezugsleistung</td>
                <td style="width:15%"></td>
                <td style="width:25%" class="align_right" *ngIf="thing.value.ActivePower > 0">{{ thing.value.ActivePower }}</td>
                <td style="width:25%" class="align_right" *ngIf="thing.value.ActivePower <= 0">0</td>
                <td style="width:10%">W</td>
              </tr>
              <tr>
                <td i18n>Einspeiseleistung</td>
                <td></td>
                <td class="align_right" *ngIf="thing.value.ActivePower < 0">{{ thing.value.ActivePower | sign }}</td>
                <td class="align_right" *ngIf="thing.value.ActivePower >= 0">0</td>
                <td>W</td>
              </tr>
              <tr class="gray_color">
                <td i18n>Blindleistung</td>
                <td></td>
                <td class="align_right">{{ thing.value.ReactivePower }}</td>
                <td>var</td>
              </tr>
            </ng-container>
            <ng-container *ngIf="!(thing.value.ActivePower != null && thing.value.ReactivePower != null) && thing.value.ActivePowerL1 != null && thing.value.ActivePowerL2 != null && thing.value.ActivePowerL3 != null">
              <tr *ngIf="thing.value.ActivePowerL1 < 0">
                <td style="width:50%" i18n>Netzeinspeisung</td>
                <td style="width:15%">L1</td>
                <td style="width:25%" class="align_right">{{ thing.value.ActivePowerL1 | sign }}</td>
                <td style="width:10%">W</td>
              </tr>
              <tr *ngIf="thing.value.ActivePowerL1 >= 0">
                <td i18n>Netzbezug</td>
                <td>L1</td>
                <td class="align_right">{{ thing.value.ActivePowerL1 }}</td>
                <td>W</td>
              </tr>
              <tr *ngIf="thing.value.ActivePowerL2 < 0">
                <td i18n>Netzeinspeisung</td>
                <td>L2</td>
                <td class="align_right">{{ thing.value.ActivePowerL2 | sign }}</td>
                <td>W</td>
              </tr>
              <tr *ngIf="thing.value.ActivePowerL2 >= 0">
                <td i18n>Netzbezug</td>
                <td>L2</td>
                <td class="align_right">{{ thing.value.ActivePowerL2 }}</td>
                <td>W</td>
              </tr>
              <tr *ngIf="thing.value.ActivePowerL3 < 0">
                <td i18n>Netzeinspeisung</td>
                <td>L3</td>
                <td class="align_right">{{ thing.value.ActivePowerL3 | sign }}</td>
                <td>W</td>
              </tr>
              <tr *ngIf="thing.value.ActivePowerL3 >= 0">
                <td i18n>Netzbezug</td>
                <td>L3</td>
                <td class="align_right">{{ thing.value.ActivePowerL3 }}</td>
                <td>W</td>
              </tr>
            </ng-container>
          </table>
        </md-card-content>
      </md-card>
    </ng-container>

    <!-- Production -->
    <ng-container *ngIf="device.things.production[thing.key]">
      <md-card *ngIf="device.websocket.isConnected == true" class="single_leftright" fxFlex="100%">
        <md-card-header>
          <img src="assets/img/production.png" md-card-avatar/>
          <md-card-title i18n>Erzeugungszähler</md-card-title>
          <md-card-subtitle>{{ thing.key }}</md-card-subtitle>
        </md-card-header>
        <md-card-content>
          <table class="full_width">
            <ng-container *ngIf="thing.value.ActivePower != null && thing.value.ReactivePower != null">
              <tr>
                <td style="width:50%" i18n>Erzeugung</td>
                <td style="width:15%"></td>
                <td style="width:25%" class="align_right">{{ thing.value.ActivePower }}</td>
                <td style="width:10%">W</td>
              </tr>
              <tr class="gray_color">
                <td i18n>Blindleistung</td>
                <td></td>
                <td class="align_right">{{ thing.value.ReactivePower }}</td>
                <td>var</td>
              </tr>
            </ng-container>
            <ng-container *ngIf="!(thing.value.ActivePower != null && thing.value.ReactivePower != null) && thing.value.ActivePowerL1 != null && thing.value.ActivePowerL2 != null && thing.value.ActivePowerL3 != null">
              <tr>
                <td style="width:50%" i18n>Erzeugung</td>
                <td style="width:15%">L1</td>
                <td style="width:25%" class="align_right">{{ thing.value.ActivePowerL1 }}</td>
                <td style="width:10%">W</td>
              </tr>
              <tr>
                <td></td>
                <td>L2</td>
                <td class="align_right">{{ thing.value.ActivePowerL2 }}</td>
                <td>W</td>
              </tr>
              <tr>
                <td></td>
                <td>L3</td>
                <td class="align_right">{{ thing.value.ActivePowerL3 }}</td>
                <td>W</td>
              </tr>
            </ng-container>
          </table>
        </md-card-content>
      </md-card>
    </ng-container>
  </ng-container>

  <!-- Consumption -->
  <ng-container *ngIf="device.summary.consumption">
    <md-card *ngIf="device.websocket.isConnected == true" class="single_leftright" fxFlex="100%">
      <md-card-header>
        <img src="assets/img/consumption.png" md-card-avatar/>
        <md-card-title i18n>Verbrauch</md-card-title>
      </md-card-header>
      <md-card-content>
        <table class="full_width">
          <ng-container *ngIf="device.summary.consumption.activePower != null">
            <tr>
              <td style="width:50%" i18n>Leistung</td>
              <td style="width:15%"></td>
              <td style="width:25%" class="align_right">{{ device.summary.consumption.activePower }}</td>
              <td style="width:10%">W</td>
            </tr>
          </ng-container>
        </table>
      </md-card-content>
    </md-card>
  </ng-container>
</div>