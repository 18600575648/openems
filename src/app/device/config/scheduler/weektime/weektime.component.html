<md-card class="single" [formGroup]="configForm">
  <md-card-header>
    <md-icon md-card-avatar>schedule</md-icon>
    <md-card-title>{{ configForm.controls["class"].value | classname }}</md-card-title>
    <md-card-subtitle>{{ configForm.controls["id"].value }}</md-card-subtitle>
  </md-card-header>
  <md-card-content>
    <div fxLayout>
      <p fxFlex="100px"></p>
      <div fxFlex fxLayout fxLayoutWrap="wrap">
        <md-select fxFlex="50%" formControlName="class" placeholder="Klasse">
          <md-option *ngFor="let element of config.value._meta.availableSchedulers" [value]="element.class"><span *ngIf="element.title">{{element.title}}: </span>{{element.class | classname}}</md-option>
        </md-select>
        <md-input-container fxFlex="50%"><input formControlName="cycleTime" type="number" placeholder="Zyklusdauer" mdInput><span md-suffix>ms</span></md-input-container>
      </div>
    </div>
    <md-tab-group>
      <md-tab *ngFor="let day of days">
        <template md-tab-label>{{ day.label }}</template>
        <div [formArrayName]="day.key">
          <div *ngFor="let hour of configForm.controls[day.key].controls; let i=index" [formGroupName]="i" fxLayout>
            <md-input-container fxFlex="100px">
              <input formControlName="time" type="text" placeholder="Startzeit" mdInput>
            </md-input-container>
            <div fxFlex="50px">
              <button md-mini-fab (click)="removeHour(configForm.controls[day.key], i)">
                <md-icon>delete</md-icon>
              </button>
            </div>
            <div formArrayName="controllers" fxFlex fxLayout fxLayoutWrap="wrap">
              <div *ngFor="let controller of hour.controls.controllers.controls; let j=index" fxLayout fxFlex.gt-md="33%" fxFlex.sm="50%"
                fxFlex.xs="100%">
                <div class="flex-container" fxFlex fxLayout>
                  <md-select [formControlName]="j" placeholder="App" fxFlex="100%">
                    <md-option *ngFor="let element of configForm.controls.controllers.controls" [value]="element.value.id">{{ element.value.id }}</md-option>
                  </md-select>
                </div>
                <div class="flex-container" fxFlex="50px">
                  <button md-mini-fab (click)="removeControllerFromHour(configForm.controls[day.key], i, j)"><md-icon>delete</md-icon></button>
                </div>
            </div>
            <div class="flex-container" fxFlex="60px">
              <button md-mini-fab (click)="addControllerToHour(configForm.controls[day.key], i)"><md-icon>add</md-icon></button>
            </div>
          </div>
        </div>
        <div fxLayout>
          <div fxFlex="100px"></div>
          <div fxFlex="50px">
            <button md-mini-fab (click)="addHour(configForm.controls[day.key])"><md-icon>add</md-icon></button>
          </div>
        </div>
        </div>
      </md-tab>

      <!-- Always -->
      <md-tab>
        <template md-tab-label>Immer</template>
        <div formArrayName="always" fxFlex fxLayout fxLayoutWrap="wrap">
          <div *ngFor="let controller of configForm.controls['always'].controls; let j=index" fxLayout fxFlex="33%">
            <div fxFlex fxLayout>
              <md-select [formControlName]="j" placeholder="App" fxFlex="100%">
                <md-option *ngFor="let element of configForm.controls.controllers.controls" [value]="element.value.id">{{ element.value.id }}</md-option>
              </md-select>
            </div>
            <div fxFlex="50px">
              <button md-mini-fab (click)="removeControllerFromAlways(j)"><md-icon>delete</md-icon></button>
            </div>
          </div>
          <div fxFlex="50px">
            <button md-mini-fab (click)="addControllerToAlways()"><md-icon>add</md-icon></button>
          </div>
        </div>
      </md-tab>
    </md-tab-group>
    <div fxLayout>
      <div fxFlex="100%"></div>
      <button md-mini-fab (click)="save(configForm)" color="primary"><md-icon>check</md-icon></button>
      <button md-mini-fab (click)="createNewScheduler(configForm)" color="primary"><md-icon>delete</md-icon></button>
    </div>
  </md-card-content>
</md-card>