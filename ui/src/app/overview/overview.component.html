<div fxLayout fxLayoutAlign="center start" fxLayoutWrap="wrap">
  <div fxFlex="50%" fxFlex.xs="100%">
    <form [formGroup]="form" (ngSubmit)="doLogin()">
      <md-card class="single">
        <md-card-header *ngIf="websocket.status == 'online'">
          <md-icon md-card-avatar>face</md-icon>
          <md-card-title translate [translateParams]="{value: 'FEMS'}">Overview.ConnectionSuccessful</md-card-title>
          <md-card-subtitle><small>{{ websocket.url }}</small></md-card-subtitle>
        </md-card-header>
        <md-card-header *ngIf="websocket.status == 'failed'">
          <md-icon md-card-avatar>stop</md-icon>
          <md-card-title translate [translateParams]="{value: 'FEMS'}">Overview.ConnectionFailed</md-card-title>
          <md-card-subtitle><small>{{ websocket.url }}</small></md-card-subtitle>
        </md-card-header>
        <md-card-header *ngIf="websocket.status == 'connecting'">
          <!-- TODO show spinner -->
          <md-icon md-card-avatar>play</md-icon>
          <md-card-title>Connecting...</md-card-title>
          <!-- TODO translate -->
          <md-card-subtitle><small>{{ websocket.url }}</small></md-card-subtitle>
        </md-card-header>
        <!-- Waiting for authentication -->
        <ng-container *ngIf="env.backend === 'OpenEMS Edge' && websocket.status == 'waiting for authentication'">
          <md-card-header>
            <md-icon md-card-avatar>stop</md-icon>
            <md-card-title>Bitte geben Sie Ihre Zugangsdaten ein</md-card-title>
            <!-- TODO translate -->
          </md-card-header>
          <md-card-content fxLayout fxLayoutWrap="wrap">
            <md-input-container fxFlex="100%"><input formControlName="password" mdInput type="password" placeholder="Passwort"></md-input-container>
            <!-- Messages -->
            <p fxFlex="100%">{{ (websocket.event | async)?.message }}</p>
          </md-card-content>
          <md-card-actions fxLayout fxLayoutAlign="end start">
            <button type="button" md-fab (click)="doLogin()" color="primary"><md-icon>check</md-icon></button>
          </md-card-actions>
        </ng-container>
        <!-- Logout from OpenEMS Edge -->
        <ng-container *ngIf="env.backend === 'OpenEMS Edge' && websocket.status == 'online'">
          <md-card-actions fxLayout fxLayoutAlign="end start">
            <button type="button" md-fab (click)="doLogout()" color="accent"><md-icon>exit_to_app</md-icon></button>
          </md-card-actions>
        </ng-container>
      </md-card>
    </form>

    <!-- List of devices -->
    <ng-container *ngFor="let device of utils.values(websocket.devices | async)">
      <md-card class="single">
        <md-card-header>
          <md-icon *ngIf="device.online" md-card-avatar color="primary">folder</md-icon>
          <md-icon *ngIf="!device.online" md-card-avatar>error</md-icon>
          <md-card-title *ngIf="env.backend === 'OpenEMS Edge'" translate>Overview.ToEnergymonitor</md-card-title>
          <md-card-title *ngIf="env.backend === 'OpenEMS Backend'">
            <span>{{ device.comment }} <span *ngIf="!device.online"><br/><span translate>Overview.IsOffline</span></span>
            </span>
          </md-card-title>
          <md-card-subtitle *ngIf="env.backend === 'OpenEMS Backend'">
            <span>{{ device.name }}: {{ device.producttype }}</span>
          </md-card-subtitle>
        </md-card-header>
        <md-card-actions fxLayout fxLayoutAlign="end start">
          <button type="button" md-fab routerLink="/device/{{ device.name }}"><md-icon>navigate_next</md-icon></button>
        </md-card-actions>
      </md-card>
    </ng-container>
  </div>
</div>