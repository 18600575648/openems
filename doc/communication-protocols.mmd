sequenceDiagram

Note over Browser,FemsServer: [1] Browser <-> FemsServer

Note over Browser,FemsServer: [1.1] Authenticate
Browser ->>+ FemsServer: session_id authentication
FemsServer ->>+ Odoo: [1.1.1] /fems/info?
Odoo -->>- FemsServer: [1.1.2] result/failed
FemsServer --> OpenEMS: is online?
FemsServer -->>- Browser: [1.1.3] authenticate: allow, metadata

Note over Browser,FemsServer: [1.2] Current data
Browser ->>+ FemsServer: [1.2.1] subscribe: channels
FemsServer ->>+ OpenEMS: [1.2.2] subscribe: channels
loop
    OpenEMS -->>+ FemsServer: [1.2.3] currentdata
    FemsServer -->>- Browser: [1.2.4] currentdata
end
Browser ->>- FemsServer: subscribe: false
FemsServer ->>- OpenEMS: subscribe: false

Note over Browser,FemsServer: [1.3] Notification
FemsServer ->> Browser: [1.3.1] notification

Note over OpenEMS,FemsServer: [2] OpenEMS <-> FemsServer

Note over OpenEMS,FemsServer: [2.1] Authenticate
OpenEMS ->> FemsServer: [2.1.1] handshake authentication
OpenEMS ->> FemsServer: [2.1.2] metadata

Note over OpenEMS,FemsServer: [2.2] timestamped data
loop
    OpenEMS ->>+ FemsServer: [2.2.1] timedata
    FemsServer ->> InfluxDB: [data]
    FemsServer ->>- Odoo: [some data]
end

Note over Browser,OpenEMS: [3] Browser <-> OpenEMS

Note over Browser,OpenEMS: [3.1] Authenticate
Browser ->>+ OpenEMS: [3.1.1] authenticate
OpenEMS ->>- Browser: [3.1.2] authenticate allow

Note over Browser,OpenEMS: [3.2] Current data
Browser ->>+ OpenEMS: [3.2.1] subscribe: channels
loop
    OpenEMS -->> Browser: [3.2.2] currentdata
end
Browser ->>- OpenEMS: subscribe: false

Note over Browser,OpenEMS: [3.3] Configuration
Browser ->>+ OpenEMS: [3.3.1] config update
Browser ->> OpenEMS: [3.3.2] config create
Browser ->> OpenEMS: [3.3.3] config delete
OpenEMS ->>- Browser: [3.3.4] metadata, notification